{% extends 'base_form.html.twig' %}

{% block title %}Profil{% endblock %}

{% block body %}
  <section class="flex items-center justify-center h-screen">
    <div class="w-3/4 h-3/4 p-6 shadow-lg bg-white rounded-md flex flex-col">
      <div class="flex justify-between gap-10 flex-1 overflow-hidden">
        {# photo part #}
        <div class="profile-header flex-2" >
          {% if app.user.profileImage %}
            <img src="{{ asset('uploads/profile_images/' ~ app.user.profileImage) }}" alt="Photo de profil" class="profile-image" width="200px">
          {% else %}
            <img src="https://placehold.co/200x200/png" alt="Default picture" class="profile-image">
          {% endif %}
          <h2 class="mt-2 text-xl text-center">{{ app.user.name }} {{ app.user.lastName }}</h2>
        </div>
        {# information #}
        <div class="flex-1 flex flex-col overflow-hidden">
          <h1 class="text-4xl font-bold text-oceanTheme-navyBlue">Information</h1>
          <hr class="my-4">
          {# Display flash messages #}
          {% for label, messages in app.flashes %}
            {% for message in messages %}
              <div class="alert alert-{{ label }}">{{ message }}</div>
            {% endfor %}
          {% endfor %}
          {# BORROWER INFORMATION #}
          <div class="flex flex-col overflow-auto">
            {% if is_granted('ROLE_BORROWER') %}
              <div class="text-2xl">Borrower</div>
              {% if app.user.subscriptions|length > 0 %}
                {% for subscription in app.user.subscriptions %}
                  <div>Subscription start date: {{ subscription.startDate|date('Y-m-d') }}</div>
                  <div>Subscription end date: {{ subscription.endDate|date('Y-m-d') }}</div>
                  <form action="{{ path('subscription_cancel', {'id': subscription.id}) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger">Cancel Subscription</button>
                  </form>
                  <br>
                {% endfor %}
              {% else %}
                <div>No subscription</div>
                <a href="{{ path('subscription_new') }}" class="btn btn-primary">Create Subscription</a>
              {% endif %}
              <br>
              {# Renting made by the borrower #}
              {% if app.user.rentings is empty %}
                <div>No renting</div>
              {% else %}
                <div>Rentings:</div>
                <ul class="overflow-y-auto max-h-36">
                  {% for renting in app.user.rentings %}
                      <li class="bg-skyTheme-lightCyan rounded-lg"> {{ renting.offer.car.brand }} {{ renting.offer.car.model }} {{ renting.startDate|date('d-m-Y') }} {{ renting.endDate|date('d-m-Y') }} {{ renting.deliveryLocation}} {{ renting.totalAmount }}â‚¬ <a class="bg-skyTheme-skyBlue rounded-full"  href="{{ path('app_dispute', {renting_id: renting.id}) }}">Declare an accident</a></li>
                  {% endfor %}
                </ul>
              {% endif %}
              <hr class="my-4">
            {% endif %}
            {# OWNER INFORMATION #}
            {% if is_granted('ROLE_OWNER') %}
              {# car owner by the owner #}
              <div class="text-2xl">Owner</div>
              {% if app.user.cars is empty %}
                <div>No car</div>
              {% else %}
                <div>Cars: </div>
                <ul class="overflow-y-auto max-h-36">
                  {% for car in app.user.cars %}
                    <li>{{ car.brand }} {{ car.model }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
              <br>
              {# Offer made by the owner #}
              {% if app.user.offers is empty %}
                <div>No offer</div>
              {% else %}
                <div>Offers: </div>
                <ul class="overflow-y-auto max-h-36">
                  {% for offer in app.user.offers %}
                    <li>{{ offer.car.brand }} {{ offer.car.model }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            {% endif %}
          </div>
          <div class="flex justify-end mt-auto pt-4">
            <a class="blue-button" href="{{ path('app_edit_user_profile') }}">Modify informations</a>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
