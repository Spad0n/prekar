{% extends 'base.html.twig' %}
{% block title %}Services Dashboard{% endblock %}

{% block body %}
    <h1>Services dashboard</h1>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">{{ message }}</div>
    {% endfor %}



    <form method="post">
        <div class="p-6">
            <input type="checkbox" name="filters[]" value="Pending" {% if "Pending" in state %}checked{% endif %}> Pending
            <input type="checkbox" name="filters[]" value="Paid" {% if "Paid" in state %}checked{% endif %}> Paid
            <button type="submit" class="btn btn-primary mt-2">Apply Filter</button>
        </div>

        <label for="service_fee">Commission rate(%) :</label>
        <input type="number" step="0.01" name="service_fee" value="0" class="form-control">
        <button type="submit" name="action" class="btn btn-primary mt-2" value="update_commission">Update</button>
        <button type="submit" name="action" class="btn btn-primary mt-2" value="UAS_commission">Update and send Payment</button>
        <button type="submit" name="action" class="btn btn-primary mt-2" value="send_payment">Send Payment</button>


    <h2 class="mt-4">Payments</h2>
    <table class="table">
        <thead>
        <tr>
            <td></td>
            <th>ID</th>
            <th>User</th>
            <th>Total (€)</th>
            <th>Status</th>
            <th>Payment Date</th>
            <th>Commission (€)</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for payment in payments %}
            {% if payment.status == 'Pending' %}
                <tr class="table-warning">
            {% else %}

                <tr>
            {% endif
            %}
                <td>{% if payment.status == 'Pending' %}<input type="checkbox" name="payments_selected[]" value="{{ payment.id }}">{% endif %}</td>
                <td>{{ payment.id }}</td>
                <td><a href="{{ path('admin_user_profilpage', {'id': payment.userOwner.getId}) }}">{{ payment.userOwner.name }} {{ payment.userOwner.lastname }}</a></td>
                <td>{{ payment.total }}</td>
                <td>{{ payment.status }}</td>
                <td>{% if payment.payDate%}
                        {{ payment.payDate|date('Y-m-d') }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if payment.apply and payment.apply.admin == app.user %}
                        {{ (payment.total * payment.apply.serviceFee) / 100 }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{% if payment.status == 'Pending' %}<button type="submit" name="action" value="process_payment_{{ payment.id }}" class="btn btn-primary mt-2">Payment</button>{% endif %}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </form>
{% endblock %}
