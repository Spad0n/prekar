{% extends 'base_form.html.twig' %}

{% block title %}Profil{% endblock %}

{% block body %}
    <section class="flex items-center justify-center h-screen">
        <div class="w-3/4 h-3/4 p-6 shadow-lg bg-white rounded-md flex flex-col">
            <div class="flex justify-between gap-10 flex-1 overflow-hidden">
                {# photo part #}
                <div class="profile-header flex-2" >
                    {% if user.profileImage %}
                        <img src="{{ asset('uploads/profile_images/' ~ profile_image) }}" alt="Photo de profil" class="profile-image" width="200px">
                    {% else %}
                        <img src="https://placehold.co/200x200/png" alt="Default picture" class="profile-image">

                    {% endif %}
                    <h2 class="mt-2 text-xl text-center">{{ user.name }} {{ user.lastName }}</h2>

                </div>
                {# information #}
                <div class="flex-1 flex flex-col overflow-hidden">
                    <h1 class="text-4xl font-bold text-oceanTheme-navyBlue">Information</h1>
                    <hr class="my-4">
                    {# BORROWER INFORMATION #}
                    <div class="flex flex-col overflow-auto">
                        {% if is_granted('ROLE_BORROWER') %}
                            <div class="text-2xl">Borrower</div>
                            {% if user.startSub is not null %}
                                <div>Subcription start date : {{ startSub|date('Y-m-d') }}</div>
                                <br>
                                <div>Subcription end date : {{ startSub|date('Y-m-d') }}</div>
                                <br>
                            {% else %}
                                <div>No subscription</div>
                            {% endif %}
                            <br>
                            {# Renting made by the borrower #}
                            {% if user.rentings is empty %}
                                <div>No renting</div>
                            {% else %}
                                <div>Rentings:</div>
                                <ul class="overflow-y-auto max-h-36">
                                    {% for renting in user.rentings %}
                                        <li> {{ renting.car.brand }} {{ renting.car.model }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <hr class="my-4">

                        {% endif %}
                        {# OWNER INFORMATION #}
                        {% if is_granted('ROLE_OWNER') %}
                            {# car owner by the owner #}
                            <div class="text-2xl">Owner</div>
                            {% if user.cars is empty %}
                                <div>No car</div>
                            {% else %}
                                <div>Cars: </div>
                                <ul class="overflow-y-auto max-h-36">
                                    {% for car in user.cars %}
                                        <li>{{ car.brand }} {{ car.model }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            <br>
                            {# Offer made by the owner #}
                            {% if user.offers is empty %}
                                <div>No offer</div>
                            {% else %}
                                <div>Offers: </div>
                                <ul class="overflow-y-auto max-h-36">
                                    {% for offer in user.offers %}
                                        <li>{{ offer.car.brand }} {{ offer.car.model }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        {% endif %}
                        <div>
                            <div class="text-2xl">Driver Licence : {{driverLicence.state}}</div>
                            <div>Driver Licence number:{% if driverLicence.driverLicenceNb %} {{ driverLicence.driverLicenceNb }} {% else %} N/A {% endif %}</div>
                            <div>Validation Date:{% if driverLicence.getValidationDate %} {{ driverLicence.getValidationDate|date('Y-m-d') }} {% else %} Still not {% endif %}</div>

                        </div>
                        <hr class="my-4">
                        <div>
                            {# Last Payments #}
                            <div class="text-2xl">Last Payments</div>
                            <div>
                                {% if user.payments is empty %}
                                    <div>No payment</div>
                                {% else %}
                                    <ul class="overflow-y-auto max-h-36">
                                        {% for payment in user.payments %}
                                            <li>Status : {{payment.status}} | Total amount : {{ payment.total }}€ | Service fee : {{ payment.apply.serviceFee }}€ | Payment Date : {% if payment.payDate%}
                                                    {{ payment.payDate|date('Y-m-d') }}
                                                {% else %}
                                                    N/A
                                                {% endif %}</li>
                                        {% endfor %}
                                    </ul>
                                {% endif %}

                        </div>
                    </div>
                    <div class="flex justify-end mt-auto pt-4">
                        <a class="blue-button" href="{{ path('admin_user_profilpage', {'id': user.id}) }}">Ban User</a>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
{% endblock %}
